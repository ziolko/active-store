(function(o,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],f):(o=typeof globalThis<"u"?globalThis:o||self,f(o["Active Store"]={},o.React))})(this,function(o,f){"use strict";let D=0;function h({onSubscribe:t,getVersion:r}={}){let e=0,n=0,s;const i=D++,u=new Map,c={getId(){return i},notify(){n+=1;for(const a of u)a[1](c)},subscribe(a){const g=e++;u.size===0&&(s=t==null?void 0:t()),u.set(g,a);let d=!1;return()=>{d||(u.delete(g),d=!0,u.size===0&&typeof s=="function"&&(s==null||s(),s=void 0))}},getVersion:r??(()=>n)};return c}function l(t){const r=l.current.signals;try{const e=new Set;l.current.signals=e;const n=t();return l.current.signals=r,{value:n,signals:e}}catch(e){throw l.current.signals=r,e}}l.current={signals:null,register(t){t&&l.current.signals&&l.current.signals.add(t)}};function v(t){let r=t;const e=h();return{get(){return l.current.register(e),r},set(n){Object.is(n,r)||(r=n,e.notify())}}}function S(t,r={}){const e=new Map;function n(s,i){const u={data:t(...i)};if(r.inertia==null)return u;u.signal=h({onSubscribe(){return g(),a}});let c;function a(){clearTimeout(c),c=setTimeout(d,r.inertia)}function g(){clearTimeout(c),c=void 0}function d(){var b;e.delete(s),(b=u.signal)==null||b.notify()}return a(),u}return{get(...s){const i=T(s);let u=e.get(i);return e.has(i)||(u=n(i,s),e.set(i,u)),u.signal&&l.current.register(u.signal),u.data},getAll(){const s=new Set;for(const i of e.values())s.add(i.data);return s}}}function T(t){return JSON.stringify(t,(r,e)=>P(e)?Object.keys(e).sort().reduce((n,s)=>(n[s]=e[s],n),{}):e)}function P(t){if(!O(t))return!1;const r=t.constructor;if(typeof r>"u")return!0;const e=r.prototype;return!(!O(e)||!e.hasOwnProperty("isPrototypeOf"))}function O(t){return Object.prototype.toString.call(t)==="[object Object]"}function C(t){let r=!1;const e=new Map;return{hasChanged(n=new Set(e.keys())){var s,i;if(!r||e.size!==n.size)return!0;for(const u of n)if(((s=e.get(u))==null?void 0:s.version)!==((i=u.getVersion)==null?void 0:i.call(u)))return!0;return!1},update(n){var s,i;for(const u of n){let c=e.get(u);c||(c={},e.set(u,c)),c.version=(s=u.getVersion)==null?void 0:s.call(u)}for(const[u,c]of e)e.has(u)||((i=c.unsubscribe)==null||i.call(c),e.delete(u));r=!0},subscribe(){for(const[n,s]of e)s.unsubscribe||(s.unsubscribe=n.subscribe(t))},unsubscribe(){var n;for(const s of e.values())(n=s.unsubscribe)==null||n.call(s),s.unsubscribe=void 0}}}function M(t){const r=S((...e)=>j(()=>t(...e)));return{get(...e){return r.get(...e)()}}}function j(t){const r=C(s),e=v({value:null,version:0}),n={isSubscribed:!1,hasAnyDependencyChanged:!1};function s(){n.hasAnyDependencyChanged=!0,u.notify()}function i(){if(n.isSubscribed&&!n.hasAnyDependencyChanged||!n.isSubscribed&&!r.hasChanged())return;const{value:c,signals:a}=l(t);r.update(a),n.isSubscribed&&r.subscribe(),e.set({value:c,version:e.get().version+1}),n.hasAnyDependencyChanged=!1}const u=h({onSubscribe(){if(n.isSubscribed=!0,r.hasChanged()){const{value:c,signals:a}=l(t);r.update(a),e.set({value:c,version:e.get().version+1})}return r.subscribe(),n.hasAnyDependencyChanged=!1,()=>{n.isSubscribed=!1,r.unsubscribe()}},getVersion(){return i(),e.get().version}});return u.isDependencies=!0,()=>(l.current.register(u),i(),e.get().value)}function k(t,r={}){const e=S((...n)=>A(()=>t(...n)));return{get(...n){return e.get(...n).get()},fetch(...n){return e.get(...n).fetch()},getAll(){return e.getAll()}}}function A(t,r){let e=null;const n=v(y("idle")),s=h({onSubscribe:()=>void setTimeout(i,0)});function i(){const u=t();e=u;const c=n.get();return n.set(y("loading",c.data,c.error)),u.then(a=>{u===e&&n.set(y("success",a))},a=>{u===e&&n.set(y("error",void 0,a))}),u}return{get(){return l.current.register(s),n.get()},fetch:i}}function y(t,r,e){return{...{idle:p("idle",!0,!1,!1,!1),loading:p("loading",!1,!0,!1,!1),success:p("success",!1,!1,!0,!1),error:p("error",!1,!1,!1,!0)}[t],data:r,error:e}}function p(t,r,e,n,s){return{status:t,isIdle:r,isLoading:e,isSuccess:n,isError:s}}function z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var E=function(r,e,n,s){var i=n?n.call(s,r,e):void 0;if(i!==void 0)return!!i;if(r===e)return!0;if(typeof r!="object"||!r||typeof e!="object"||!e)return!1;var u=Object.keys(r),c=Object.keys(e);if(u.length!==c.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(e),g=0;g<u.length;g++){var d=u[g];if(!a(d))return!1;var b=r[d],m=e[d];if(i=n?n.call(s,b,m,d):void 0,i===!1||i===void 0&&b!==m)return!1}return!0};const q=z(E);function I(t){return w(t)}function Q(t){return w(t)}function R(){let t,r=C(()=>t()),e;return{subscribe(n){return t=n,r.subscribe(),()=>{r==null||r.unsubscribe(),t=null}},getSnapshot(n){const{value:s,signals:i}=l(n);return r.update(i),t&&r.subscribe(),!Object.is(e,s)&&!q(e,s)&&(e=s),e}}}function w(t){const r=f.useMemo(R,[]);return f.useSyncExternalStore(r.subscribe,()=>r.getSnapshot(t))}function U(t,r){const e=f.useRef(t);return f.useEffect(()=>{r&&(e.current=t)},[r,t]),r?t:e.current}function _(t){const[r,e]=f.useState({status:"idle",result:void 0,error:void 0});function n(){}return{...r,execute:n}}o.createCollection=S,o.createComputed=M,o.createQuery=k,o.createSignal=h,o.createState=v,o.execute=l,o.useActions=Q,o.useData=I,o.useMutation=_,o.useStaleWhileRevalidate=U,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
